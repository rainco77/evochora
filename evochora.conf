pipeline {
  startupSequence = ["consumer", "producer"]

  resources {
    test-queue {
      className = "org.evochora.datapipeline.resources.queues.InMemoryBlockingQueue"
      options {
        capacity = 1000
        throughputWindowSeconds = 5
      }
    }
  }

  services {
    consumer {
      className = "org.evochora.datapipeline.services.DummyConsumerService"
      resources {
        input = "queue-in:test-queue"
      }
      options {
        processingDelayMs = 50
        maxMessages = 100
      }
    }

    producer {
      className = "org.evochora.datapipeline.services.DummyProducerService"
      resources {
        output = "queue-out:test-queue?window=2"
      }
      options {
        intervalMs = 100
        maxMessages = 100
      }
    }
  }
}

logging {
  format = "PLAIN"
  level = "WARN"
  loggers {
    "org.evochora.datapipeline.ServiceManager" = "INFO"
    "org.evochora.datapipeline.services.DummyProducerService" = "INFO"
    "org.evochora.datapipeline.services.DummyConsumerService" = "INFO"
  }
}

# The node block configures the server process itself
node {
  # Defines all long-running processes the Node should start and manage
  processes {

    # Logical name for the HTTP server process
    httpServer {
      className = "org.evochora.node.processes.http.HttpServerProcess"
      options {
        network {
          host = "0.0.0.0"
          port = 8080
        }

        # All routes are defined within the HttpServerProcess's options
        routes {
          # The nesting of objects defines the URL paths.
          # Actions ($controller, $static) are defined by keys prefixed with '$'.
          pipeline {
            # ACTION: Serves static UI files at the base path "/pipeline"
            # The static file handler serves from the classpath. A directory named
            # 'web/pipeline-control' should exist in 'src/main/resources'.
            #"$static" = "/web/pipeline-control"

            # Builds the sub-path "/pipeline/api"
            api {
              # ACTION: Serves a controller at "/pipeline/api"
              "$controller" {
                className = "org.evochora.node.http.api.pipeline.PipelineController"
                options {}
              }
            }
          }
        }
      }
    }
  }
}